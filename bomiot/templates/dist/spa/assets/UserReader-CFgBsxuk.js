import{Q as F}from"./QPage-ltF7SocP.js";import{u as K}from"./use-meta-CzUauSHJ.js";import{u as A}from"./use-quasar-3xwWZP-X.js";import{u as G,Q as g}from"./QItemLabel-DS2al5LE.js";import{d as Q,r,o as D,w as I,a4 as U,a5 as w,a8 as s,a9 as l,aa as m,af as c,a7 as i,M as S,ab as p,a6 as q,ax as H,aM as J,ai as X,as as Y,j as Z,ad as ee}from"./index-C_Y_PPsx.js";import{b as te,a as ae}from"./rtl-CKniQFeG.js";import{Q as ne,a as oe,b as se}from"./QTable-CXbehKl6.js";import{e as le,g as ie,p as y}from"./axios-CfM96r7k.js";import{u as re}from"./language-B_adsXDX.js";import{u as de}from"./vue-i18n.runtime-BehzTcvC.js";const ce={class:"q-pa-md"},ue={key:0},fe={key:1},me={__name:"UserList",setup(T){const{t:a}=de(),n=A(),h=G(),b=re(),x=Q(()=>[{name:"username",required:!0,label:a("username"),align:"left",field:"username"},{name:"date_joined",label:a("date_joined"),field:"date_joined"},{name:"last_login",label:a("last_login"),field:"last_login"},{name:"updated_time",label:a("updated_time"),field:"updated_time"},{name:"action",label:a("action"),align:"right"}]),k=Q(()=>h.token),u=r([]),C=r([]),P=r([]),_=r(""),$=r(0),v=r({sortBy:"updated_time",descending:!1,page:1,rowsPerPage:30,rowsNumber:30}),V=Q(()=>k.value!==""?Math.ceil($.value/v.value.rowsPerPage):0),L=r(`${n.screen.height*.73}px`),M=r(`${n.screen.width*.825}px`),z=r(n.dark.isActive?"#121212":"#ffffff");function d(o){let e={};o?e=o:e.pagination=v.value,ie({url:"core/user/",params:{search:_.value,page:e.pagination.page,max_page:e.pagination.rowsPerPage}}).then(t=>{u.value=t.results,$.value=t.count,C.value=t.team,P.value=t.department}).catch(t=>{n.notify({type:"error",message:t}),n.loading.hide()}),v.value=e.pagination}async function O(){n.dialog({dark:n.dark.isActive,title:a("newUser"),message:a("createuser"),prompt:{model:"",isValid:o=>o.length>2,type:"text"},cancel:!0}).onOk(async o=>{await y("core/user/create/",{username:o}).then(()=>{d()}).catch(e=>{n.notify({type:"error",message:e}),n.loading.hide()})})}function j(o){n.dialog({dark:n.dark.isActive,title:a("changepassword"),message:a("changePWD"),prompt:{model:"",isValid:e=>e.length>2,type:"text"},cancel:!0}).onOk(async e=>{await y("core/user/changepwd/",{id:u.value[o].id,pwd:e}).then(()=>{}).catch(t=>{n.notify({type:"error",message:t}),n.loading.hide()})})}function N(o){n.dialog({title:a("setteam"),message:a("chooseteam"),options:{type:"radio",model:u.value[o].team,items:C.value},cancel:!0}).onOk(async e=>{await y("core/user/team/",{id:u.value[o].id,team_id:e}).then(()=>{d()}).catch(t=>{n.notify({type:"error",message:t}),n.loading.hide()})})}function R(o){n.dialog({title:a("setdepartment"),message:a("choosedepartment"),options:{type:"radio",model:u.value[o].department,items:P.value},cancel:!0}).onOk(async e=>{await y("core/user/department/",{id:u.value[o].id,department_id:e}).then(()=>{d()}).catch(t=>{n.notify({type:"error",message:t}),n.loading.hide()})})}async function B(o){await y("core/user/lock/",{id:u.value[o].id}).then(()=>{d()}).catch(e=>{n.notify({type:"error",message:e}),n.loading.hide()})}function W(o){n.dialog({dark:n.dark.isActive,title:a("deleteuser"),message:a("confirmnotice"),cancel:!0}).onOk(async()=>{await y("core/user/delete/",{id:u.value[o].id}).then(()=>{d()}).catch(e=>{n.notify({type:"error",message:e}),n.loading.hide()})})}D(()=>{E(),d()}),I(()=>n.dark.isActive,o=>{z.value=o?"#121212":"#ffffff"});function E(){le.on("needLogin",o=>{o&&(u.value=[],C.value=[],_.value="",$.value=0)})}return I(()=>b.langData,o=>{o&&d()}),(o,e)=>(w(),U("div",ce,[s(se,{class:Y(i(n).dark.isActive?"my-sticky-header-last-column-table-dark":"my-sticky-header-last-column-table"),flat:"",bordered:"",rows:u.value,columns:x.value,"row-key":"index",pagination:v.value,"onUpdate:pagination":e[7]||(e[7]=t=>v.value=t),separator:"cell","no-data-label":i(a)("nodata"),"rows-per-page-label":i(a)("per_page"),"rows-per-page-options":[30,50,200,1e3],"table-style":{height:L.value,width:M.value},"card-style":{backgroundColor:z.value},onRequest:d},{top:l(t=>[s(te,{flat:""},{default:l(()=>[s(p,{label:i(a)("refresh"),icon:"refresh",onClick:e[0]||(e[0]=f=>d())},{default:l(()=>[s(g,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[m(c(i(a)("refreshdata")),1)]),_:1})]),_:1},8,["label"]),s(p,{label:i(a)("new"),icon:"add",onClick:e[1]||(e[1]=f=>O())},{default:l(()=>[s(g,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[m(c(i(a)("newUser")),1)]),_:1})]),_:1},8,["label"])]),_:1}),s(ae),s(H,{dense:"",debounce:"300",color:"primary",modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=f=>_.value=f),onInput:e[3]||(e[3]=f=>d()),onKeyup:e[4]||(e[4]=J(f=>d(),["enter"]))},{append:l(()=>[s(X,{name:"search"})]),_:1},8,["modelValue"]),s(p,{flat:"",round:"",dense:"",icon:t.inFullscreen?"fullscreen_exit":"fullscreen",onClick:t.toggleFullscreen},null,8,["icon","onClick"])]),"body-cell":l(t=>[s(oe,{props:t},{default:l(()=>[t.col.name==="action"?(w(),U("div",ue,[s(p,{round:"",flat:"",icon:"published_with_changes",onClick:f=>j(t.rowIndex)},{default:l(()=>[s(g,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[m(c(i(a)("changepassword")),1)]),_:1})]),_:2},1032,["onClick"]),s(p,{round:"",flat:"",icon:"diversity_3",onClick:f=>N(t.rowIndex)},{default:l(()=>[s(g,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[m(c(i(a)("setteam")),1)]),_:1})]),_:2},1032,["onClick"]),s(p,{round:"",flat:"",icon:"diversity_2",onClick:f=>R(t.rowIndex)},{default:l(()=>[s(g,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[m(c(i(a)("setdepartment")),1)]),_:1})]),_:2},1032,["onClick"]),S(s(p,{round:"",flat:"",icon:"lock_person",onClick:f=>B(t.rowIndex)},{default:l(()=>[s(g,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[m(c(i(a)("isnotactive")),1)]),_:1})]),_:2},1032,["onClick"]),[[q,!t.row.is_active]]),S(s(p,{round:"",flat:"",icon:"lock_open",onClick:f=>B(t.rowIndex)},{default:l(()=>[s(g,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[m(c(i(a)("isactive")),1)]),_:1})]),_:2},1032,["onClick"]),[[q,t.row.is_active]]),s(p,{round:"",flat:"",icon:"delete_sweep",onClick:f=>W(t.rowIndex)},{default:l(()=>[s(g,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[m(c(i(a)("deleteuser")),1)]),_:1})]),_:2},1032,["onClick"])])):(w(),U("div",fe,c(t.value),1))]),_:2},1032,["props"])]),pagination:l(()=>[m(c(i(a)("total"))+c(V.value)+" "+c(i(a)("page"))+" ",1),s(ne,{modelValue:v.value.page,"onUpdate:modelValue":[e[5]||(e[5]=t=>v.value.page=t),e[6]||(e[6]=t=>d())],max:V.value,input:"","input-class":"text-orange-10"},null,8,["modelValue","max"])]),_:1},8,["class","rows","columns","pagination","no-data-label","rows-per-page-label","table-style","card-style"])]))}},Ce={__name:"UserReader",setup(T){const a=A(),n=r(!1),h=r(""),b=r(""),x=r("");return K(()=>({title:h.value,meta:{description:{name:"description",content:b.value},keywords:{name:"keywords",content:x.value}}})),D(()=>{}),Z(()=>{}),I(()=>a.dark.isActive,k=>{n.value=k}),(k,u)=>(w(),ee(F,{class:"flex flex-top"},{default:l(()=>[s(me)]),_:1}))}};export{Ce as default};
