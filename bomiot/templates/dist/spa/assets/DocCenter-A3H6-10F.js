import{Q as j}from"./QPage-Bzd8r64O.js";import{u as M}from"./use-meta-DBhDbqAd.js";import{u as L}from"./use-quasar-B36StsOf.js";import{u as O,Q as w}from"./QItemLabel-DuwV9MuD.js";import{a as Q,r as i,o as T,w as S,a2 as y,a3 as $,a6 as o,a7 as s,a9 as p,a5 as r,a8 as v,ad as f,aw as J,aJ as K,ai as H,J as P,a4 as V,ar as W,e as X,ab as Y}from"./index-DexK82ub.js";import{a as Z,b as ee}from"./rtl-JPk8tYAA.js";import{Q as ae,a as te,b as ne}from"./QTable-BB9YLlwL.js";import{e as oe,g as le,p as q}from"./axios-DagOQdKT.js";import{u as se}from"./language-BdTIPJbB.js";import{u as ie}from"./vue-i18n.runtime-pJi-Ro9L.js";const re={class:"q-pa-md"},de={key:0},ce={key:1},ue={__name:"DocList",setup(U){const{t}=ie(),l=L(),g=O(),_=se(),x=Q(()=>[{name:"name",required:!0,label:t("doc.name"),align:"left",field:"name"},{name:"type",align:"center",label:t("doc.type"),field:"type"},{name:"size",align:"center",label:t("doc.size"),field:"size"},{name:"owner",align:"center",label:t("doc.owner"),field:"owner"},{name:"created_time",align:"center",label:t("created_time"),field:"created_time"},{name:"updated_time",align:"center",label:t("updated_time"),field:"updated_time"},{name:"action",label:t("action"),align:"right"}]),k=Q(()=>g.token),d=i([]),h=i([]),b=i(""),C=i(0),m=i({sortBy:"updated_time",descending:!1,page:1,rowsPerPage:30,rowsNumber:30}),I=Q(()=>k.value!==""?Math.ceil(C.value/m.value.rowsPerPage):0),z=i(l.screen.height*.73+"px"),A=i(l.screen.width*.825+"px"),D=i(l.dark.isActive?"#121212":"#ffffff");function u(n){let e={};n?e=n:e.pagination=m.value,g.tokenDataGet!==""&&(le({url:"core/user/files/",params:{search:b.value,page:e.pagination.page,max_page:e.pagination.rowsPerPage}}).then(a=>{d.value=a.results,C.value=a.count,h.value=a.users}).catch(a=>{l.notify({type:"error",message:a}),l.loading.hide()}),m.value=e.pagination)}function E(n){fetch("media/"+g.tokenDataGet.username+"/"+d.value[n].name).then(e=>{if(!e.ok)throw new Error("Network response was not ok.");return e.blob()}).then(e=>{const a=document.createElement("a");a.href=window.URL.createObjectURL(e),a.download=d.value[n].name,a.click()}).catch(e=>{l.notify({type:"error",message:e})})}function F(n){var e=[];h.value.forEach(a=>{e.push({label:a.toString().split(",")[1],value:a.toString().split(",")[0]})}),l.dialog({title:t("doc.share"),message:t("doc.shared_to"),options:{type:"checkbox",model:e,inline:!0,items:h.value},cancel:!0}).onOk(a=>{q("core/user/files/share/",{id:d.value[n].id,users:a}).then(()=>{u()}).catch(c=>{l.notify({type:"error",message:c}),l.loading.hide()})})}function B(n){return["jpg","jpeg","png","bmp","gif","tiff","webp","svg","psd","raw","tga","ico"].includes(n.type)}function N(n){l.dialog({title:d.value[n].name,message:`<img src="media/${g.tokenDataGet.username}/${d.value[n].name}" style="max-height: ${z.value}; width: 100%">`,html:!0})}function G(n){l.dialog({dark:l.dark.isActive,title:t("doc.deletefile"),message:t("doc.deletefilenotice"),cancel:!0}).onOk(()=>{q("core/user/file/delete/",{id:d.value[n].id}).then(()=>{u()}).catch(e=>{l.notify({type:"error",message:e}),l.loading.hide()})})}T(()=>{R(),u()}),S(()=>l.dark.isActive,n=>{D.value=n?"#121212":"#ffffff"});function R(){oe.on("needLogin",n=>{n&&(d.value=[],h.value=[],b.value="",C.value=0)})}return S(()=>_.langData,n=>{n&&u()}),(n,e)=>(y(),$("div",re,[o(ne,{class:W(r(l).dark.isActive?"my-sticky-header-last-column-table-dark":"my-sticky-header-last-column-table"),flat:"",bordered:"",rows:d.value,columns:x.value,"row-key":"index",pagination:m.value,"onUpdate:pagination":e[6]||(e[6]=a=>m.value=a),separator:"cell","no-data-label":r(t)("nodata"),"rows-per-page-label":r(t)("per_page"),"rows-per-page-options":[10,30,50,200,1e3],"table-style":{height:z.value,width:A.value},"card-style":{backgroundColor:D.value},onRequest:u},{top:s(a=>[o(Z,{flat:""},{default:s(()=>[o(p,{label:r(t)("refresh"),icon:"refresh",onClick:e[0]||(e[0]=c=>u())},{default:s(()=>[o(w,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[v(f(r(t)("refreshdata")),1)]),_:1})]),_:1},8,["label"])]),_:1}),o(ee),o(J,{dense:"",debounce:"300",color:"primary",modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=c=>b.value=c),onInput:e[2]||(e[2]=c=>u()),onKeyup:e[3]||(e[3]=K(c=>u(),["enter"]))},{append:s(()=>[o(H,{name:"search"})]),_:1},8,["modelValue"]),o(p,{flat:"",round:"",dense:"",icon:a.inFullscreen?"fullscreen_exit":"fullscreen",onClick:a.toggleFullscreen},null,8,["icon","onClick"])]),"body-cell":s(a=>[o(ae,{props:a},{default:s(()=>[a.col.name==="action"?(y(),$("div",de,[P(o(p,{round:"",flat:"",icon:"visibility",onClick:c=>N(a.rowIndex)},{default:s(()=>[o(w,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[v(f(r(t)("doc.download")),1)]),_:1})]),_:2},1032,["onClick"]),[[V,B(a.row)]]),P(o(p,{round:"",flat:"",icon:"cloud_download",onClick:c=>E(a.rowIndex)},{default:s(()=>[o(w,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[v(f(r(t)("doc.download")),1)]),_:1})]),_:2},1032,["onClick"]),[[V,!B(a.row)]]),o(p,{round:"",flat:"",icon:"share",onClick:c=>F(a.rowIndex)},{default:s(()=>[o(w,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[v(f(r(t)("doc.shared_to")),1)]),_:1})]),_:2},1032,["onClick"]),o(p,{round:"",flat:"",icon:"delete_sweep",onClick:c=>G(a.rowIndex)},{default:s(()=>[o(w,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[v(f(r(t)("doc.deletefile")),1)]),_:1})]),_:2},1032,["onClick"])])):(y(),$("div",ce,f(a.value),1))]),_:2},1032,["props"])]),pagination:s(()=>[v(f(r(t)("total"))+f(I.value)+" "+f(r(t)("page"))+" ",1),o(te,{modelValue:m.value.page,"onUpdate:modelValue":[e[4]||(e[4]=a=>m.value.page=a),e[5]||(e[5]=a=>u())],max:I.value,input:"","input-class":"text-orange-10"},null,8,["modelValue","max"])]),_:1},8,["class","rows","columns","pagination","no-data-label","rows-per-page-label","table-style","card-style"])]))}},_e={__name:"DocCenter",setup(U){const t=L(),l=i(!1),g=i(""),_=i(""),x=i("");return M(()=>({title:g.value,meta:{description:{name:"description",content:_.value},keywords:{name:"keywords",content:x.value}}})),T(()=>{}),X(()=>{}),S(()=>t.dark.isActive,k=>{l.value=k}),(k,d)=>(y(),Y(j,{class:"flex flex-top"},{default:s(()=>[o(ue)]),_:1}))}};export{_e as default};
