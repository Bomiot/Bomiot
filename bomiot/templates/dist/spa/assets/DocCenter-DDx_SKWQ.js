import{Q as j}from"./QPage-yVQa7NMe.js";import{u as O}from"./use-meta-BCCGAtcF.js";import{u as T}from"./use-quasar-DMvh-O4G.js";import{u as H,Q as w}from"./QItemLabel-By-EDHpl.js";import{a as B,r,o as V,w as Q,a2 as z,a3 as y,a6 as l,a7 as i,a8 as g,ad as f,a5 as c,K as P,a9 as v,a4 as q,av as J,aJ as W,ag as X,aq as Y,e as Z,ab as ee}from"./index-CW7bXRGx.js";import{a as te,b as ae}from"./rtl-C5W-Fgak.js";import{Q as ne,a as oe,b as le}from"./QTable-D5jfZGyI.js";import{e as se,a as ie,t as M}from"./axios-8Qm6Y-QI.js";import{u as re}from"./language-DL4TzfLp.js";import{u as de}from"./vue-i18n.runtime-LLxG5jvi.js";const ce={class:"q-pa-md"},ue={key:0},fe={key:1},me={__name:"DocList",setup(F){const{t:n}=de(),s=T(),p=H(),_=re(),b=B(()=>[{name:"name",required:!0,label:n("doc.name"),align:"left",field:"name"},{name:"type",align:"center",label:n("doc.type"),field:"type"},{name:"size",align:"center",label:n("doc.size"),field:"size"},{name:"owner",align:"center",label:n("doc.owner"),field:"owner"},{name:"created_time",align:"center",label:n("created_time"),field:"created_time"},{name:"updated_time",align:"center",label:n("updated_time"),field:"updated_time"},{name:"action",label:n("action"),align:"right"}]),h=B(()=>p.token),d=r([]),x=r([]),k=r(""),C=r(0),m=r({sortBy:"updated_time",descending:!1,page:1,rowsPerPage:30,rowsNumber:30}),$=B(()=>h.value!==""?Math.ceil(C.value/m.value.rowsPerPage):0),S=r(s.screen.height*.73+"px"),N=r(s.screen.width*.825+"px"),I=r(s.dark.isActive?"#121212":"#ffffff");function G(a){if(a===0)return"0 Bytes";const e=["Bytes","KB","MB","GB","TB"],t=Math.floor(Math.log(a)/Math.log(1024)),o=(a/Math.pow(1024,t)).toFixed(2);return new Intl.NumberFormat().format(o)+" "+e[t]}function u(a){let e={};a?e=a:e.pagination=m.value,p.tokenDataGet!==""&&(ie({url:"core/user/files/",params:{search:k.value,page:e.pagination.page,max_page:e.pagination.rowsPerPage}}).then(t=>{d.value=t.results.map(o=>({...o,name:o.name,type:o.type,size:G(o.size),owner:o.owner,created_time:o.created_time,updated_time:o.updated_time})),C.value=t.count,x.value=t.users}).catch(t=>{s.notify({type:"error",message:t}),s.loading.hide()}),m.value=e.pagination)}function L(a){fetch("media/"+p.tokenDataGet.username+"/"+d.value[a].name).then(e=>{if(!e.ok)throw new Error("Network response was not ok.");return e.blob()}).then(e=>{const t=document.createElement("a");t.href=window.URL.createObjectURL(e),t.download=d.value[a].name,t.click()}).catch(e=>{s.notify({type:"error",message:e})})}function U(a){const e=/<->(\d+)<->/g,t=[];let o;for(;(o=e.exec(a))!==null;)t.push(Number(o[1]));return t}function A(a){var e=U(d.value[a].shared_to);s.dialog({title:n("doc.share"),message:n("doc.shared_to"),options:{type:"checkbox",model:e,inline:!0,items:x.value},cancel:!0}).onOk(async t=>{await M("core/user/files/share/",{id:d.value[a].id,users:t}).then(()=>{u()}).catch(o=>{s.notify({type:"error",message:o}),s.loading.hide()})})}function D(a){return["jpg","jpeg","png","bmp","gif","tiff","webp","svg","psd","raw","tga","ico"].includes(a.type)}function E(a){s.dialog({title:d.value[a].name,message:`<img src="media/${p.tokenDataGet.username}/${d.value[a].name}" style="max-height: ${S.value}; width: 100%">`,html:!0})}function K(a){s.dialog({dark:s.dark.isActive,title:n("doc.deletefile"),message:n("doc.deletefilenotice"),cancel:!0}).onOk(async()=>{await M("core/user/files/delete/",{id:d.value[a].id}).then(()=>{u()}).catch(e=>{s.notify({type:"error",message:e}),s.loading.hide()})})}V(()=>{R(),u()}),Q(()=>s.dark.isActive,a=>{I.value=a?"#121212":"#ffffff"});function R(){se.on("needLogin",a=>{a&&(d.value=[],x.value=[],k.value="",C.value=0)})}return Q(()=>_.langData,a=>{a&&u()}),(a,e)=>(y(),z("div",ce,[l(le,{class:Y(c(s).dark.isActive?"my-sticky-header-last-column-table-dark":"my-sticky-header-last-column-table"),flat:"",bordered:"",rows:d.value,columns:b.value,"row-key":"index",pagination:m.value,"onUpdate:pagination":e[6]||(e[6]=t=>m.value=t),separator:"cell","no-data-label":c(n)("nodata"),"rows-per-page-label":c(n)("per_page"),"rows-per-page-options":[10,30,50,200,1e3],"table-style":{height:S.value,width:N.value},"card-style":{backgroundColor:I.value},onRequest:u},{top:i(t=>[l(te,{flat:""},{default:i(()=>[l(v,{label:c(n)("refresh"),icon:"refresh",onClick:e[0]||(e[0]=o=>u())},{default:i(()=>[l(w,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:i(()=>[g(f(c(n)("refreshdata")),1)]),_:1})]),_:1},8,["label"])]),_:1}),l(ae),l(J,{dense:"",debounce:"300",color:"primary",modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=o=>k.value=o),onInput:e[2]||(e[2]=o=>u()),onKeyup:e[3]||(e[3]=W(o=>u(),["enter"]))},{append:i(()=>[l(X,{name:"search"})]),_:1},8,["modelValue"]),l(v,{flat:"",round:"",dense:"",icon:t.inFullscreen?"fullscreen_exit":"fullscreen",onClick:t.toggleFullscreen},null,8,["icon","onClick"])]),"body-cell":i(t=>[l(oe,{props:t},{default:i(()=>[t.col.name==="action"?(y(),z("div",ue,[P(l(v,{round:"",flat:"",icon:"visibility",onClick:o=>E(t.rowIndex)},{default:i(()=>[l(w,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:i(()=>[g(f(c(n)("doc.download")),1)]),_:1})]),_:2},1032,["onClick"]),[[q,D(t.row)]]),P(l(v,{round:"",flat:"",icon:"cloud_download",onClick:o=>L(t.rowIndex)},{default:i(()=>[l(w,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:i(()=>[g(f(c(n)("doc.download")),1)]),_:1})]),_:2},1032,["onClick"]),[[q,!D(t.row)]]),l(v,{round:"",flat:"",icon:"share",onClick:o=>A(t.rowIndex)},{default:i(()=>[l(w,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:i(()=>[g(f(c(n)("doc.shared_to")),1)]),_:1})]),_:2},1032,["onClick"]),l(v,{round:"",flat:"",icon:"delete_sweep",onClick:o=>K(t.rowIndex)},{default:i(()=>[l(w,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:i(()=>[g(f(c(n)("doc.deletefile")),1)]),_:1})]),_:2},1032,["onClick"])])):(y(),z("div",fe,f(t.value),1))]),_:2},1032,["props"])]),pagination:i(()=>[g(f(c(n)("total"))+f($.value)+" "+f(c(n)("page"))+" ",1),l(ne,{modelValue:m.value.page,"onUpdate:modelValue":[e[4]||(e[4]=t=>m.value.page=t),e[5]||(e[5]=t=>u())],max:$.value,input:"","input-class":"text-orange-10"},null,8,["modelValue","max"])]),_:1},8,["class","rows","columns","pagination","no-data-label","rows-per-page-label","table-style","card-style"])]))}},Ce={__name:"DocCenter",setup(F){const n=T(),s=r(!1),p=r(""),_=r(""),b=r("");return O(()=>({title:p.value,meta:{description:{name:"description",content:_.value},keywords:{name:"keywords",content:b.value}}})),V(()=>{}),Z(()=>{}),Q(()=>n.dark.isActive,h=>{s.value=h}),(h,d)=>(y(),ee(j,{class:"flex flex-top"},{default:i(()=>[l(me)]),_:1}))}};export{Ce as default};
