import{Q as K}from"./QPage-ndr1C9jp.js";import{u as M}from"./use-meta-DH1jTThB.js";import{u as L}from"./use-quasar-CFfcHwN_.js";import{u as O,Q as w}from"./QItemLabel-Bp-Oxd1p.js";import{a as Q,r,o as N,w as I,a2 as $,a3 as b,a6 as o,a7 as s,a8 as p,ad as f,a5 as c,K as q,a9 as v,a4 as P,av as H,aJ as J,ag as W,aq as X,e as Y,ab as Z}from"./index-Bv7wNieA.js";import{a as ee,b as te}from"./rtl-DKTE3rCv.js";import{Q as ae,a as ne,b as oe}from"./QTable-BjjShl0Z.js";import{e as le,g as se,p as V}from"./axios-CJC2MDvx.js";import{u as ie}from"./language-XeXqxrNG.js";import{u as re}from"./vue-i18n.runtime-3O6FdQdx.js";const de={class:"q-pa-md"},ce={key:0},ue={key:1},fe={__name:"DocList",setup(T){const{t:n}=re(),l=L(),g=O(),y=ie(),_=Q(()=>[{name:"name",required:!0,label:n("doc.name"),align:"left",field:"name"},{name:"type",align:"center",label:n("doc.type"),field:"type"},{name:"size",align:"center",label:n("doc.size"),field:"size"},{name:"owner",align:"center",label:n("doc.owner"),field:"owner"},{name:"created_time",align:"center",label:n("created_time"),field:"created_time"},{name:"updated_time",align:"center",label:n("updated_time"),field:"updated_time"},{name:"action",label:n("action"),align:"right"}]),k=Q(()=>g.token),d=r([]),x=r([]),h=r(""),C=r(0),m=r({sortBy:"updated_time",descending:!1,page:1,rowsPerPage:30,rowsNumber:30}),S=Q(()=>k.value!==""?Math.ceil(C.value/m.value.rowsPerPage):0),z=r(l.screen.height*.73+"px"),U=r(l.screen.width*.825+"px"),B=r(l.dark.isActive?"#121212":"#ffffff");function u(a){let e={};a?e=a:e.pagination=m.value,g.tokenDataGet!==""&&(se({url:"core/user/files/",params:{search:h.value,page:e.pagination.page,max_page:e.pagination.rowsPerPage}}).then(t=>{d.value=t.results,C.value=t.count,x.value=t.users}).catch(t=>{l.notify({type:"error",message:t}),l.loading.hide()}),m.value=e.pagination)}function A(a){fetch("media/"+g.tokenDataGet.username+"/"+d.value[a].name).then(e=>{if(!e.ok)throw new Error("Network response was not ok.");return e.blob()}).then(e=>{const t=document.createElement("a");t.href=window.URL.createObjectURL(e),t.download=d.value[a].name,t.click()}).catch(e=>{l.notify({type:"error",message:e})})}function F(a){const e=/<->(\d+)<->/g,t=[];let i;for(;(i=e.exec(a))!==null;)t.push(Number(i[1]));return t}function E(a){var e=F(d.value[a].shared_to);l.dialog({title:n("doc.share"),message:n("doc.shared_to"),options:{type:"checkbox",model:e,inline:!0,items:x.value},cancel:!0}).onOk(t=>{V("core/user/files/share/",{id:d.value[a].id,users:t}).then(()=>{u()}).catch(i=>{l.notify({type:"error",message:i}),l.loading.hide()})})}function D(a){return["jpg","jpeg","png","bmp","gif","tiff","webp","svg","psd","raw","tga","ico"].includes(a.type)}function G(a){l.dialog({title:d.value[a].name,message:`<img src="media/${g.tokenDataGet.username}/${d.value[a].name}" style="max-height: ${z.value}; width: 100%">`,html:!0})}function R(a){l.dialog({dark:l.dark.isActive,title:n("doc.deletefile"),message:n("doc.deletefilenotice"),cancel:!0}).onOk(()=>{V("core/user/files/delete/",{id:d.value[a].id}).then(()=>{u()}).catch(e=>{l.notify({type:"error",message:e}),l.loading.hide()})})}N(()=>{j(),u()}),I(()=>l.dark.isActive,a=>{B.value=a?"#121212":"#ffffff"});function j(){le.on("needLogin",a=>{a&&(d.value=[],x.value=[],h.value="",C.value=0)})}return I(()=>y.langData,a=>{a&&u()}),(a,e)=>(b(),$("div",de,[o(oe,{class:X(c(l).dark.isActive?"my-sticky-header-last-column-table-dark":"my-sticky-header-last-column-table"),flat:"",bordered:"",rows:d.value,columns:_.value,"row-key":"index",pagination:m.value,"onUpdate:pagination":e[6]||(e[6]=t=>m.value=t),separator:"cell","no-data-label":c(n)("nodata"),"rows-per-page-label":c(n)("per_page"),"rows-per-page-options":[10,30,50,200,1e3],"table-style":{height:z.value,width:U.value},"card-style":{backgroundColor:B.value},onRequest:u},{top:s(t=>[o(ee,{flat:""},{default:s(()=>[o(v,{label:c(n)("refresh"),icon:"refresh",onClick:e[0]||(e[0]=i=>u())},{default:s(()=>[o(w,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[p(f(c(n)("refreshdata")),1)]),_:1})]),_:1},8,["label"])]),_:1}),o(te),o(H,{dense:"",debounce:"300",color:"primary",modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=i=>h.value=i),onInput:e[2]||(e[2]=i=>u()),onKeyup:e[3]||(e[3]=J(i=>u(),["enter"]))},{append:s(()=>[o(W,{name:"search"})]),_:1},8,["modelValue"]),o(v,{flat:"",round:"",dense:"",icon:t.inFullscreen?"fullscreen_exit":"fullscreen",onClick:t.toggleFullscreen},null,8,["icon","onClick"])]),"body-cell":s(t=>[o(ne,{props:t},{default:s(()=>[t.col.name==="action"?(b(),$("div",ce,[q(o(v,{round:"",flat:"",icon:"visibility",onClick:i=>G(t.rowIndex)},{default:s(()=>[o(w,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[p(f(c(n)("doc.download")),1)]),_:1})]),_:2},1032,["onClick"]),[[P,D(t.row)]]),q(o(v,{round:"",flat:"",icon:"cloud_download",onClick:i=>A(t.rowIndex)},{default:s(()=>[o(w,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[p(f(c(n)("doc.download")),1)]),_:1})]),_:2},1032,["onClick"]),[[P,!D(t.row)]]),o(v,{round:"",flat:"",icon:"share",onClick:i=>E(t.rowIndex)},{default:s(()=>[o(w,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[p(f(c(n)("doc.shared_to")),1)]),_:1})]),_:2},1032,["onClick"]),o(v,{round:"",flat:"",icon:"delete_sweep",onClick:i=>R(t.rowIndex)},{default:s(()=>[o(w,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:s(()=>[p(f(c(n)("doc.deletefile")),1)]),_:1})]),_:2},1032,["onClick"])])):(b(),$("div",ue,f(t.value),1))]),_:2},1032,["props"])]),pagination:s(()=>[p(f(c(n)("total"))+f(S.value)+" "+f(c(n)("page"))+" ",1),o(ae,{modelValue:m.value.page,"onUpdate:modelValue":[e[4]||(e[4]=t=>m.value.page=t),e[5]||(e[5]=t=>u())],max:S.value,input:"","input-class":"text-orange-10"},null,8,["modelValue","max"])]),_:1},8,["class","rows","columns","pagination","no-data-label","rows-per-page-label","table-style","card-style"])]))}},xe={__name:"DocCenter",setup(T){const n=L(),l=r(!1),g=r(""),y=r(""),_=r("");return M(()=>({title:g.value,meta:{description:{name:"description",content:y.value},keywords:{name:"keywords",content:_.value}}})),N(()=>{}),Y(()=>{}),I(()=>n.dark.isActive,k=>{l.value=k}),(k,d)=>(b(),Z(K,{class:"flex flex-top"},{default:s(()=>[o(fe)]),_:1}))}};export{xe as default};
