import{u as M,Q as R}from"./use-meta--Hrpp0vY.js";import{u as L,a as W}from"./language-dFM129Nl.js";import{u as E,Q as k}from"./QItemLabel-BEeCnilI.js";import{a as $,r,o as z,w as S,a5 as x,a6 as G,a9 as s,aa as l,J as _,ac as p,a8 as i,ab as v,ag as c,a7 as y,ay as K,aL as H,ak as J,at as X,e as Y,ae as Z}from"./index-DH65uPR4.js";import{a as ee,b as te}from"./rtl-DDq5PkBF.js";import{Q as ae,a as ne,b as se}from"./QTable-u5V4CIqk.js";import{e as oe,g as ie,p as h}from"./axios-DfrIyqix.js";import{u as le}from"./vue-i18n.runtime-8Htf9csn.js";const re={class:"q-pa-md"},de={key:0},ue={key:1},ce={__name:"UserList",setup(q){const{t}=le(),n=L(),d=E(),C=W(),P=$(()=>[{name:"username",required:!0,label:t("username"),align:"left",field:"username"},{name:"date_joined",label:t("date_joined"),field:"date_joined"},{name:"last_login",label:t("last_login"),field:"last_login"},{name:"updated_time",label:t("updated_time"),field:"updated_time",sortable:!0},{name:"action",label:t("action"),align:"right"}]),w=$(()=>d.token),m=r([]),U=r([]),b=r(""),Q=r(0),g=r({sortBy:"updated_time",descending:!1,page:1,rowsPerPage:30,rowsNumber:30}),V=$(()=>w.value!==""?Math.ceil(Q.value/g.value.rowsPerPage):0),A=r(n.screen.height*.73+"px"),D=r(n.screen.width*.825+"px"),B=r(n.dark.isActive?"#121212":"#ffffff");function u(o){let e={};o?e=o:e.pagination=g.value,d.userPermissionGet("Get User List")&&(ie({url:"core/user/",params:{search:b.value,ordering:(g.value.descending?"-":"")+g.value.sortBy,page:e.pagination.page,max_page:e.pagination.rowsPerPage}}).then(a=>{m.value=a.results,Q.value=a.count,U.value=a.permission}).catch(a=>{n.notify({type:"error",message:a}),n.loading.hide()}),g.value=e.pagination)}function O(){n.dialog({dark:n.dark.isActive,title:t("newUser"),message:t("createuser"),prompt:{model:"",isValid:o=>o.length>2,type:"text"},cancel:!0}).onOk(o=>{h("core/user/create/",{username:o}).then(()=>{u()}).catch(e=>{n.notify({type:"error",message:e}),n.loading.hide()})})}function T(o){n.dialog({dark:n.dark.isActive,title:t("changepassword"),message:t("changePWD"),prompt:{model:"",isValid:e=>e.length>2,type:"text"},cancel:!0}).onOk(e=>{h("core/user/changepwd/",{id:m.value[o].id,pwd:e}).then(()=>{}).catch(a=>{n.notify({type:"error",message:a}),n.loading.hide()})})}function j(o){n.dialog({title:t("permission"),message:t("choosepermission"),options:{type:"checkbox",model:Object.keys(m.value[o].permission),inline:!0,items:U.value},cancel:!0}).onOk(e=>{h("core/user/setpermission/",{id:m.value[o].id,permission:e}).then(()=>{u()}).catch(a=>{n.notify({type:"error",message:a}),n.loading.hide()})})}function I(o){h("core/user/lock/",{id:m.value[o].id}).then(()=>{u()}).catch(e=>{n.notify({type:"error",message:e}),n.loading.hide()})}function N(o){n.dialog({dark:n.dark.isActive,title:t("deleteuser"),message:t("confirmnotice"),cancel:!0}).onOk(()=>{h("core/user/delete/",{id:m.value[o].id}).then(()=>{u()}).catch(e=>{n.notify({type:"error",message:e}),n.loading.hide()})})}z(()=>{F(),u()}),S(()=>n.dark.isActive,o=>{B.value=o?"#121212":"#ffffff"});function F(){oe.on("needLogin",o=>{o&&(m.value=[],U.value=[],b.value="",Q.value=0)})}return S(()=>C.langData,o=>{o&&u()}),(o,e)=>(x(),G("div",re,[s(se,{class:X(i(n).dark.isActive?"my-sticky-header-last-column-table-dark":"my-sticky-header-last-column-table"),flat:"",bordered:"",rows:m.value,columns:P.value,"row-key":"index",pagination:g.value,"onUpdate:pagination":e[7]||(e[7]=a=>g.value=a),separator:"cell","no-data-label":i(t)("nodata"),"rows-per-page-label":i(t)("per_page"),"rows-per-page-options":[1,30,50,200,1e3],"table-style":{height:A.value,width:D.value},"card-style":{backgroundColor:B.value},onRequest:u},{top:l(a=>[s(ee,{flat:""},{default:l(()=>[_(s(p,{label:i(t)("refresh"),icon:"refresh",onClick:e[0]||(e[0]=f=>u())},{default:l(()=>[s(k,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[v(c(i(t)("refreshdata")),1)]),_:1})]),_:1},8,["label"]),[[y,i(d).userPermissionGet("Get User List")]]),_(s(p,{label:i(t)("new"),icon:"add",onClick:e[1]||(e[1]=f=>O())},{default:l(()=>[s(k,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[v(c(i(t)("newUser")),1)]),_:1})]),_:1},8,["label"]),[[y,i(d).userPermissionGet("Create One User")]])]),_:1}),s(te),s(K,{dense:"",debounce:"300",color:"primary",modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=f=>b.value=f),onInput:e[3]||(e[3]=f=>u()),onKeyup:e[4]||(e[4]=H(f=>u(),["enter"]))},{append:l(()=>[s(J,{name:"search"})]),_:1},8,["modelValue"]),s(p,{flat:"",round:"",dense:"",icon:a.inFullscreen?"fullscreen_exit":"fullscreen",onClick:a.toggleFullscreen},null,8,["icon","onClick"])]),"body-cell":l(a=>[s(ae,{props:a},{default:l(()=>[a.col.name==="action"?(x(),G("div",de,[_(s(p,{round:"",flat:"",icon:"published_with_changes",onClick:f=>T(a.rowIndex)},{default:l(()=>[s(k,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[v(c(i(t)("changepassword")),1)]),_:1})]),_:2},1032,["onClick"]),[[y,i(d).userPermissionGet("Change Password")]]),_(s(p,{round:"",flat:"",icon:"admin_panel_settings",onClick:f=>j(a.rowIndex)},{default:l(()=>[s(k,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[v(c(i(t)("permission")),1)]),_:1})]),_:2},1032,["onClick"]),[[y,i(d).userPermissionGet("Set Permission For User")]]),_(s(p,{round:"",flat:"",icon:"lock_person",onClick:f=>I(a.rowIndex)},{default:l(()=>[s(k,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[v(c(i(t)("isnotactive")),1)]),_:1})]),_:2},1032,["onClick"]),[[y,!a.row.is_active&&i(d).userPermissionGet("Lock & Unlock User")]]),_(s(p,{round:"",flat:"",icon:"lock_open",onClick:f=>I(a.rowIndex)},{default:l(()=>[s(k,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[v(c(i(t)("isactive")),1)]),_:1})]),_:2},1032,["onClick"]),[[y,a.row.is_active&&i(d).userPermissionGet("Lock & Unlock User")]]),_(s(p,{round:"",flat:"",icon:"delete_sweep",onClick:f=>N(a.rowIndex)},{default:l(()=>[s(k,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[v(c(i(t)("deleteuser")),1)]),_:1})]),_:2},1032,["onClick"]),[[y,i(d).userPermissionGet("Delete One User")]])])):(x(),G("div",ue,c(a.value),1))]),_:2},1032,["props"])]),pagination:l(()=>[v(c(i(t)("total"))+c(V.value)+" "+c(i(t)("page"))+" ",1),s(ne,{modelValue:g.value.page,"onUpdate:modelValue":[e[5]||(e[5]=a=>g.value.page=a),e[6]||(e[6]=a=>u())],max:V.value,input:"","input-class":"text-orange-10"},null,8,["modelValue","max"])]),_:1},8,["class","rows","columns","pagination","no-data-label","rows-per-page-label","table-style","card-style"])]))}},he={__name:"UserReader",setup(q){const t=L(),n=r(!1),d=r(""),C=r(""),P=r("");return M(()=>({title:d.value,meta:{description:{name:"description",content:C.value},keywords:{name:"keywords",content:P.value}}})),z(()=>{}),Y(()=>{}),S(()=>t.dark.isActive,w=>{n.value=w}),(w,m)=>(x(),Z(R,{class:"flex flex-top"},{default:l(()=>[s(ce)]),_:1}))}};export{he as default};
