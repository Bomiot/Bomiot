import{Q as R}from"./QPage-jfhvxjua.js";import{u as W}from"./use-meta-B2AcZUiy.js";import{u as L}from"./use-quasar-YIAhzlRm.js";import{u as E,Q as v}from"./QItemLabel-CBTzOxdh.js";import{a as Q,r,o as q,w as I,a2 as G,a3 as x,a6 as s,a7 as l,a8 as g,ad as u,a5 as i,K as k,a9 as p,a4 as y,av as H,aJ as J,ag as X,aq as Y,e as Z,ab as ee}from"./index-DA5wU65Q.js";import{a as te,b as ae}from"./rtl-BUksX-Hb.js";import{Q as ne,a as oe,b as se}from"./QTable-wSipynsH.js";import{e as ie,a as le,t as h}from"./axios-BxiOjpGq.js";import{u as re}from"./language-BAls7FvS.js";import{u as de}from"./vue-i18n.runtime-DQPK7Hwk.js";const ce={class:"q-pa-md"},ue={key:0},me={key:1},fe={__name:"UserList",setup(B){const{t:a}=de(),n=L(),d=E(),C=re(),P=Q(()=>[{name:"username",required:!0,label:a("username"),align:"left",field:"username"},{name:"date_joined",label:a("date_joined"),field:"date_joined"},{name:"last_login",label:a("last_login"),field:"last_login"},{name:"updated_time",label:a("updated_time"),field:"updated_time"},{name:"action",label:a("action"),align:"right"}]),w=Q(()=>d.token),m=r([]),U=r([]),S=r([]),b=r(""),$=r(0),_=r({sortBy:"updated_time",descending:!1,page:1,rowsPerPage:30,rowsNumber:30}),V=Q(()=>w.value!==""?Math.ceil($.value/_.value.rowsPerPage):0),T=r(`${n.screen.height*.73}px`),A=r(`${n.screen.width*.825}px`),z=r(n.dark.isActive?"#121212":"#ffffff");function c(o){let e={};o?e=o:e.pagination=_.value,d.userPermissionGet("Get User List")&&(le({url:"core/user/",params:{search:b.value,page:e.pagination.page,max_page:e.pagination.rowsPerPage}}).then(t=>{m.value=t.results,$.value=t.count,U.value=t.team,S.value=t.department}).catch(t=>{n.notify({type:"error",message:t}),n.loading.hide()}),_.value=e.pagination)}async function O(){n.dialog({dark:n.dark.isActive,title:a("newUser"),message:a("createuser"),prompt:{model:"",isValid:o=>o.length>2,type:"text"},cancel:!0}).onOk(async o=>{await h("core/user/create/",{username:o}).then(()=>{c()}).catch(e=>{n.notify({type:"error",message:e}),n.loading.hide()})})}function F(o){n.dialog({dark:n.dark.isActive,title:a("changepassword"),message:a("changePWD"),prompt:{model:"",isValid:e=>e.length>2,type:"text"},cancel:!0}).onOk(async e=>{await h("core/user/changepwd/",{id:m.value[o].id,pwd:e}).then(()=>{}).catch(t=>{n.notify({type:"error",message:t}),n.loading.hide()})})}function N(o){n.dialog({title:a("setteam"),message:a("chooseteam"),options:{type:"radio",model:m.value[o].team,items:U.value},cancel:!0}).onOk(async e=>{await h("core/user/team/",{id:m.value[o].id,team_id:e}).then(()=>{c()}).catch(t=>{n.notify({type:"error",message:t}),n.loading.hide()})})}function j(o){n.dialog({title:a("setdepartment"),message:a("choosedepartment"),options:{type:"radio",model:m.value[o].department,items:S.value},cancel:!0}).onOk(async e=>{await h("core/user/department/",{id:m.value[o].id,department_id:e}).then(()=>{c()}).catch(t=>{n.notify({type:"error",message:t}),n.loading.hide()})})}async function D(o){await h("core/user/lock/",{id:m.value[o].id}).then(()=>{c()}).catch(e=>{n.notify({type:"error",message:e}),n.loading.hide()})}function K(o){n.dialog({dark:n.dark.isActive,title:a("deleteuser"),message:a("confirmnotice"),cancel:!0}).onOk(async()=>{await h("core/user/delete/",{id:m.value[o].id}).then(()=>{c()}).catch(e=>{n.notify({type:"error",message:e}),n.loading.hide()})})}q(()=>{M(),c()}),I(()=>n.dark.isActive,o=>{z.value=o?"#121212":"#ffffff"});function M(){ie.on("needLogin",o=>{o&&(m.value=[],U.value=[],b.value="",$.value=0)})}return I(()=>C.langData,o=>{o&&c()}),(o,e)=>(x(),G("div",ce,[s(se,{class:Y(i(n).dark.isActive?"my-sticky-header-last-column-table-dark":"my-sticky-header-last-column-table"),flat:"",bordered:"",rows:m.value,columns:P.value,"row-key":"index",pagination:_.value,"onUpdate:pagination":e[7]||(e[7]=t=>_.value=t),separator:"cell","no-data-label":i(a)("nodata"),"rows-per-page-label":i(a)("per_page"),"rows-per-page-options":[30,50,200,1e3],"table-style":{height:T.value,width:A.value},"card-style":{backgroundColor:z.value},onRequest:c},{top:l(t=>[s(te,{flat:""},{default:l(()=>[k(s(p,{label:i(a)("refresh"),icon:"refresh",onClick:e[0]||(e[0]=f=>c())},{default:l(()=>[s(v,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[g(u(i(a)("refreshdata")),1)]),_:1})]),_:1},8,["label"]),[[y,i(d).userPermissionGet("Get User List")]]),k(s(p,{label:i(a)("new"),icon:"add",onClick:e[1]||(e[1]=f=>O())},{default:l(()=>[s(v,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[g(u(i(a)("newUser")),1)]),_:1})]),_:1},8,["label"]),[[y,i(d).userPermissionGet("Create One User")]])]),_:1}),s(ae),s(H,{dense:"",debounce:"300",color:"primary",modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=f=>b.value=f),onInput:e[3]||(e[3]=f=>c()),onKeyup:e[4]||(e[4]=J(f=>c(),["enter"]))},{append:l(()=>[s(X,{name:"search"})]),_:1},8,["modelValue"]),s(p,{flat:"",round:"",dense:"",icon:t.inFullscreen?"fullscreen_exit":"fullscreen",onClick:t.toggleFullscreen},null,8,["icon","onClick"])]),"body-cell":l(t=>[s(oe,{props:t},{default:l(()=>[t.col.name==="action"?(x(),G("div",ue,[k(s(p,{round:"",flat:"",icon:"published_with_changes",onClick:f=>F(t.rowIndex)},{default:l(()=>[s(v,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[g(u(i(a)("changepassword")),1)]),_:1})]),_:2},1032,["onClick"]),[[y,i(d).userPermissionGet("Change Password")]]),k(s(p,{round:"",flat:"",icon:"diversity_3",onClick:f=>N(t.rowIndex)},{default:l(()=>[s(v,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[g(u(i(a)("setteam")),1)]),_:1})]),_:2},1032,["onClick"]),[[y,i(d).userPermissionGet("Set Team For User")]]),k(s(p,{round:"",flat:"",icon:"diversity_2",onClick:f=>j(t.rowIndex)},{default:l(()=>[s(v,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[g(u(i(a)("setdepartment")),1)]),_:1})]),_:2},1032,["onClick"]),[[y,i(d).userPermissionGet("Set Department For User")]]),k(s(p,{round:"",flat:"",icon:"lock_person",onClick:f=>D(t.rowIndex)},{default:l(()=>[s(v,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[g(u(i(a)("isnotactive")),1)]),_:1})]),_:2},1032,["onClick"]),[[y,!t.row.is_active&&i(d).userPermissionGet("Lock & Unlock User")]]),k(s(p,{round:"",flat:"",icon:"lock_open",onClick:f=>D(t.rowIndex)},{default:l(()=>[s(v,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[g(u(i(a)("isactive")),1)]),_:1})]),_:2},1032,["onClick"]),[[y,t.row.is_active&&i(d).userPermissionGet("Lock & Unlock User")]]),k(s(p,{round:"",flat:"",icon:"delete_sweep",onClick:f=>K(t.rowIndex)},{default:l(()=>[s(v,{class:"bg-indigo",offset:[10,10],"content-style":"font-size: 12px"},{default:l(()=>[g(u(i(a)("deleteuser")),1)]),_:1})]),_:2},1032,["onClick"]),[[y,i(d).userPermissionGet("Delete One User")]])])):(x(),G("div",me,u(t.value),1))]),_:2},1032,["props"])]),pagination:l(()=>[g(u(i(a)("total"))+u(V.value)+" "+u(i(a)("page"))+" ",1),s(ne,{modelValue:_.value.page,"onUpdate:modelValue":[e[5]||(e[5]=t=>_.value.page=t),e[6]||(e[6]=t=>c())],max:V.value,input:"","input-class":"text-orange-10"},null,8,["modelValue","max"])]),_:1},8,["class","rows","columns","pagination","no-data-label","rows-per-page-label","table-style","card-style"])]))}},Ce={__name:"UserReader",setup(B){const a=L(),n=r(!1),d=r(""),C=r(""),P=r("");return W(()=>({title:d.value,meta:{description:{name:"description",content:C.value},keywords:{name:"keywords",content:P.value}}})),q(()=>{}),Z(()=>{}),I(()=>a.dark.isActive,w=>{n.value=w}),(w,m)=>(x(),ee(R,{class:"flex flex-top"},{default:l(()=>[s(fe)]),_:1}))}};export{Ce as default};
